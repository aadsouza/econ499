------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/amedeusdsouza/econ499/distreg/marg_crate.log
  log type:  text
 opened on:  22 Feb 2021, 16:04:54

. 
. local periods "0017" //add in 8388 8800 when probit fin

. 
. forval hrs = 1(1)6{
  2.         forval p = 1(1)1{
  3.                 local per: word `p' of `periods'
  4.                 
.                 di "hrs = `hrs', period = `per'"
  5.                 
.                 use "$estimation/stacked_`per'_`hrs'", clear
  6.                 
.                 keep if covered == 0
  7.                 
.                 gen byte min3b = diff <= -3
  8.                 gen byte min2b = diff <= -2
  9.                 gen byte min1b = diff <= -1
 10.                 
.                 gen byte min = diff <= 0
 11.                 
.                 gen byte min1a = diff <= 1
 12.                 gen byte min2a = diff <= 2
 13.                 gen byte min3a = diff <= 3
 14.                 gen byte min4a = diff <= 4
 15.                 
.                 gen lyear  = (year - 2000)/10
 16.                 gen lyear2 = lyear^2
 17.                 
.                 gen lwagcat = (wagcat - 28)/10
 18.                 
.                 gen byte ee_cl =.
 19.                         replace ee_cl = 1  if inrange(educ, 0, 11)  & inrange(exper, 0, 9)
 20.                         replace ee_cl = 2  if inrange(educ, 12, 12) & inrange(exper, 0, 9)
 21.                         replace ee_cl = 3  if inrange(educ, 13, 15) & inrange(exper, 0, 9)
 22.                         replace ee_cl = 4  if inrange(educ, 16, 18) & inrange(exper, 0, 9)
 23.                         replace ee_cl = 5  if inrange(educ, 0, 11)  & inrange(exper, 10, 19
> )
 24.                         replace ee_cl = 6  if inrange(educ, 12, 12) & inrange(exper, 10, 19
> )
 25.                         replace ee_cl = 7  if inrange(educ, 13, 15) & inrange(exper, 10, 19
> )
 26.                         replace ee_cl = 8  if inrange(educ, 16, 18) & inrange(exper, 10, 19
> )
 27.                         replace ee_cl = 9  if inrange(educ, 0, 11)  & inrange(exper, 20, 29
> )
 28.                         replace ee_cl = 10 if inrange(educ, 12, 12) & inrange(exper, 20, 29
> )
 29.                         replace ee_cl = 11 if inrange(educ, 13, 15) & inrange(exper, 20, 29
> )
 30.                         replace ee_cl = 12 if inrange(educ, 16, 18) & inrange(exper, 20, 29
> )
 31.                         replace ee_cl = 13 if inrange(educ, 0, 11)  & inrange(exper, 30, .)
 32.                         replace ee_cl = 14 if inrange(educ, 12, 12) & inrange(exper, 30, .)
 33.                         replace ee_cl = 15 if inrange(educ, 13, 15) & inrange(exper, 30, .)
 34.                         replace ee_cl = 16 if inrange(educ, 16, 18) & inrange(exper, 30, .)
>              
 35.                 
.                 replace exper = exper/10
 36.                 gen exper2 = exper^2
 37.                 gen exper3 = exper^3
 38.                 gen exper4 = exper^4
 39.                 
.                 gen edex = educ*exper
 40.                 
.                 recode nocc (1 6 = 1) (2 = 2) (3 4 = 3) (5 = 4) (7 = 5) (8 = 6) (9 = 7) (10 11
>  = 8) ///
>                 (12 = 9) (13 15 = 10) (14 = 11) (16 = 12), gen(nocc2)
 41.                 
.                 recode nocc2 (1 2 3 4 5 = 1) (6 7 8 = 2) (9 = 3) (10 11 12 = 4), gen(nocc3) //
>  FIXME FLL2021 expect to use 4 occ but 13-16 exist?
 42.                 
.                 gen actual_cr = coveragerate
 43.                 
.                 scalar tau = 0.01
 44.                 
.                 est use $estimation/un_`per'_`hrs'_0
 45.                 
.                 replace coveragerate = actual_cr
 46.                 gen crate1 = coveragerate*lwagcat
 47.                 gen crate2 = coveragerate*lwagcat^2
 48.                 gen crate3 = coveragerate*lwagcat^3
 49.                 gen crate4 = coveragerate*lwagcat^4
 50.                 predict pnu
 51.                 
.                 replace coveragerate = actual_cr +tau
 52.                 replace crate1 = coveragerate*lwagcat
 53.                 replace crate2 = coveragerate*lwagcat^2
 54.                 replace crate3 = coveragerate*lwagcat^3
 55.                 replace crate4 = coveragerate*lwagcat^4
 56.                 predict pnu_cr1                 
 57.                 
.                 gen p_cumwage = pnu
 58.                         replace p_cumwage = cumwage if wagcat==1 | wagcat==58
 59.                         
.                 gen c_cumwage = pnu_cr1
 60.                         replace c_cumwage = cumwage if wagcat==1 | wagcat==58
 61.                 
.                 collapse cumwage p_cumwage c_cumwage [w=fweight], by(year quarter wagcat)
 62.                 
.                 sort year quarter wagcat
 63.                 
.                 by year quarter: gen prw = cumwage-cumwage[_n+1]
 64.                 by year quarter: gen p_prw = p_cumwage-p_cumwage[_n+1]
 65.                 by year quarter: gen c_prw = c_cumwage-c_cumwage[_n+1]
 66.                 
.                 replace prw = cumwage if wagcat == 58
 67.                 replace p_prw = p_cumwage if wagcat == 58
 68.                 replace c_prw = c_cumwage if wagcat == 58
 69.                 
.                 collapse (mean) prw p_prw c_prw, by(wagcat)
 70.                 
.                 sort wagcat
 71.                 gen prw_cum = sum(prw)
 72.                 gen p_prw_cum = sum(p_prw)
 73.                 gen c_prw_cum = sum(c_prw)
 74.                 
.                 gen slope = (p_prw_cum[_n+4] - p_prw_cum)/.2 in 1/54
 75.                 gen wage_effect = (p_prw_cum - c_prw_cum)/slope
 76.                 
.                 rename p_prw_cum percentile
 77.                 keep wagcat wage_effect percentile
 78.                 
.                 line wage_effect percentile if inrange(percentile, .05, 0.95)
 79.                 
.                 save "$estimation/marg_crate_data_`per'_`hrs'.dta", replace 
 80.         }
 81. }
hrs = 1, period = 0017
(6,255,648 observations deleted)
(35,775,908 missing values generated)
(1,136,336 real changes made)
(2,376,492 real changes made)
(2,862,822 real changes made)
(3,055,614 real changes made)
(312,272 real changes made)
(2,256,374 real changes made)
(2,329,976 real changes made)
(3,627,204 real changes made)
(324,858 real changes made)
(2,459,780 real changes made)
(2,294,770 real changes made)
(3,398,162 real changes made)
(512,778 real changes made)
(3,081,076 real changes made)
(2,644,394 real changes made)
(2,936,714 real changes made)
(34,818,386 real changes made)
(25653342 differences between nocc and nocc2)
(31204812 differences between nocc2 and nocc3)
(59,334 missing values generated)
(0 real changes made)
(59,334 missing values generated)
(59,334 missing values generated)
(59,334 missing values generated)
(59,334 missing values generated)
(option pr assumed; Pr(cumwage))
(231,768 missing values generated)
(35,716,574 real changes made)
(35,100,771 real changes made)
(35,100,771 real changes made)
(35,100,771 real changes made)
(35,100,771 real changes made)
(option pr assumed; Pr(cumwage))
(231,768 missing values generated)
(231,768 missing values generated)
(1,233,395 real changes made)
(231,768 missing values generated)
(1,233,413 real changes made)
(analytic weights assumed)
(80 missing values generated)
(80 missing values generated)
(80 missing values generated)
(80 real changes made)
(80 real changes made)
(80 real changes made)
(4 missing values generated)
(4 missing values generated)
(note: file /Users/amedeusdsouza/Desktop/econ499data/estimation/marg_crate_data_0017_1.dta not f
> ound)
file /Users/amedeusdsouza/Desktop/econ499data/estimation/marg_crate_data_0017_1.dta saved
hrs = 2, period = 0017
(705,512 observations deleted)
(3,166,046 missing values generated)
(92,742 real changes made)
(276,196 real changes made)
(275,848 real changes made)
(177,654 real changes made)
(41,122 real changes made)
(287,970 real changes made)
(252,822 real changes made)
(228,462 real changes made)
(46,574 real changes made)
(289,884 real changes made)
(229,100 real changes made)
(192,502 real changes made)
(99,528 real changes made)
(308,502 real changes made)
(212,628 real changes made)
(137,460 real changes made)
(3,100,506 real changes made)
(2653732 differences between nocc and nocc2)
(2976502 differences between nocc2 and nocc3)
(4,582 missing values generated)
(0 real changes made)
(4,582 missing values generated)
(4,582 missing values generated)
(4,582 missing values generated)
(4,582 missing values generated)
(option pr assumed; Pr(cumwage))
(22,330 missing values generated)
(3,161,464 real changes made)
(3,106,956 real changes made)
(3,106,956 real changes made)
(3,106,956 real changes made)
(3,106,956 real changes made)
(option pr assumed; Pr(cumwage))
(22,330 missing values generated)
(22,330 missing values generated)
(109,165 real changes made)
(22,330 missing values generated)
(109,165 real changes made)
(analytic weights assumed)
(80 missing values generated)
(80 missing values generated)
(80 missing values generated)
(80 real changes made)
(80 real changes made)
(80 real changes made)
(4 missing values generated)
(4 missing values generated)
(note: file /Users/amedeusdsouza/Desktop/econ499data/estimation/marg_crate_data_0017_2.dta not f
> ound)
file /Users/amedeusdsouza/Desktop/econ499data/estimation/marg_crate_data_0017_2.dta saved
hrs = 3, period = 0017
(844,596 observations deleted)
(6,581,144 missing values generated)
(386,860 real changes made)
(730,684 real changes made)
(480,472 real changes made)
(217,210 real changes made)
(601,286 real changes made)
(699,132 real changes made)
(356,642 real changes made)
(236,466 real changes made)
(582,030 real changes made)
(499,322 real changes made)
(241,512 real changes made)
(172,608 real changes made)
(646,526 real changes made)
(334,834 real changes made)
(169,012 real changes made)
(98,948 real changes made)
(6,438,348 real changes made)
(5936184 differences between nocc and nocc2)
(6326060 differences between nocc2 and nocc3)
(11,948 missing values generated)
(0 real changes made)
(11,948 missing values generated)
(11,948 missing values generated)
(11,948 missing values generated)
(11,948 missing values generated)
(option pr assumed; Pr(cumwage))
(145,580 missing values generated)
(6,569,196 real changes made)
(6,455,934 real changes made)
(6,455,934 real changes made)
(6,455,934 real changes made)
(6,455,934 real changes made)
(option pr assumed; Pr(cumwage))
(145,580 missing values generated)
(145,580 missing values generated)
(226,924 real changes made)
(145,580 missing values generated)
(226,925 real changes made)
(analytic weights assumed)
(80 missing values generated)
(80 missing values generated)
(80 missing values generated)
(80 real changes made)
(80 real changes made)
(80 real changes made)
(4 missing values generated)
(4 missing values generated)
(note: file /Users/amedeusdsouza/Desktop/econ499data/estimation/marg_crate_data_0017_3.dta not f
> ound)
file /Users/amedeusdsouza/Desktop/econ499data/estimation/marg_crate_data_0017_3.dta saved
hrs = 4, period = 0017
(5,536,796 observations deleted)
(36,632,104 missing values generated)
(1,052,294 real changes made)
(1,809,948 real changes made)
(3,288,600 real changes made)
(3,673,024 real changes made)
(172,666 real changes made)
(1,677,186 real changes made)
(2,581,754 real changes made)
(3,441,198 real changes made)
(210,366 real changes made)
(2,377,652 real changes made)
(2,961,828 real changes made)
(3,179,038 real changes made)
(383,496 real changes made)
(3,652,202 real changes made)
(3,444,214 real changes made)
(2,484,720 real changes made)
(35,396,414 real changes made)
(29522232 differences between nocc and nocc2)
(33667144 differences between nocc2 and nocc3)
(21,692 missing values generated)
(0 real changes made)
(21,692 missing values generated)
(21,692 missing values generated)
(21,692 missing values generated)
(21,692 missing values generated)
(option pr assumed; Pr(cumwage))
(265,756 missing values generated)
(36,610,412 real changes made)
(35,979,198 real changes made)
(35,979,198 real changes made)
(35,979,198 real changes made)
(35,979,198 real changes made)
(option pr assumed; Pr(cumwage))
(265,756 missing values generated)
(265,756 missing values generated)
(1,263,038 real changes made)
(265,756 missing values generated)
(1,263,053 real changes made)
(analytic weights assumed)
(80 missing values generated)
(80 missing values generated)
(80 missing values generated)
(80 real changes made)
(80 real changes made)
(80 real changes made)
(4 missing values generated)
(4 missing values generated)
(note: file /Users/amedeusdsouza/Desktop/econ499data/estimation/marg_crate_data_0017_4.dta not f
> ound)
file /Users/amedeusdsouza/Desktop/econ499data/estimation/marg_crate_data_0017_4.dta saved
hrs = 5, period = 0017
(826,268 observations deleted)
(4,406,202 missing values generated)
(107,532 real changes made)
(313,954 real changes made)
(445,672 real changes made)
(297,134 real changes made)
(58,000 real changes made)
(350,030 real changes made)
(428,678 real changes made)
(327,120 real changes made)
(59,740 real changes made)
(345,854 real changes made)
(365,168 real changes made)
(272,832 real changes made)
(109,910 real changes made)
(390,630 real changes made)
(331,992 real changes made)
(178,292 real changes made)
(4,304,528 real changes made)
(3761300 differences between nocc and nocc2)
(4194676 differences between nocc2 and nocc3)
(2,262 missing values generated)
(0 real changes made)
(2,262 missing values generated)
(2,262 missing values generated)
(2,262 missing values generated)
(2,262 missing values generated)
(option pr assumed; Pr(cumwage))
(26,158 missing values generated)
(4,403,940 real changes made)
(4,328,010 real changes made)
(4,328,010 real changes made)
(4,328,010 real changes made)
(4,328,010 real changes made)
(option pr assumed; Pr(cumwage))
(26,158 missing values generated)
(26,158 missing values generated)
(151,864 real changes made)
(26,158 missing values generated)
(151,870 real changes made)
(analytic weights assumed)
(80 missing values generated)
(80 missing values generated)
(80 missing values generated)
(80 real changes made)
(80 real changes made)
(80 real changes made)
(4 missing values generated)
(4 missing values generated)
(note: file /Users/amedeusdsouza/Desktop/econ499data/estimation/marg_crate_data_0017_5.dta not f
> ound)
file /Users/amedeusdsouza/Desktop/econ499data/estimation/marg_crate_data_0017_5.dta saved
hrs = 6, period = 0017
(685,850 observations deleted)
(5,311,466 missing values generated)
(230,376 real changes made)
(520,782 real changes made)
(586,380 real changes made)
(277,066 real changes made)
(258,854 real changes made)
(483,546 real changes made)
(407,160 real changes made)
(260,304 real changes made)
(324,742 real changes made)
(402,056 real changes made)
(286,462 real changes made)
(173,768 real changes made)
(419,862 real changes made)
(312,620 real changes made)
(197,606 real changes made)
(83,288 real changes made)
(5,142,860 real changes made)
(4775372 differences between nocc and nocc2)
(5119138 differences between nocc2 and nocc3)
(3,016 missing values generated)
(0 real changes made)
(3,016 missing values generated)
(3,016 missing values generated)
(3,016 missing values generated)
(3,016 missing values generated)
(option pr assumed; Pr(cumwage))
(91,002 missing values generated)
(5,308,450 real changes made)
(5,216,925 real changes made)
(5,216,925 real changes made)
(5,216,925 real changes made)
(5,216,925 real changes made)
(option pr assumed; Pr(cumwage))
(91,002 missing values generated)
(91,002 missing values generated)
(183,152 real changes made)
(91,002 missing values generated)
(183,152 real changes made)
(analytic weights assumed)
(80 missing values generated)
(80 missing values generated)
(80 missing values generated)
(80 real changes made)
(80 real changes made)
(80 real changes made)
(4 missing values generated)
(4 missing values generated)
(note: file /Users/amedeusdsouza/Desktop/econ499data/estimation/marg_crate_data_0017_6.dta not f
> ound)
file /Users/amedeusdsouza/Desktop/econ499data/estimation/marg_crate_data_0017_6.dta saved

. 
. log close
      name:  <unnamed>
       log:  /Users/amedeusdsouza/econ499/distreg/marg_crate.log
  log type:  text
 closed on:  22 Feb 2021, 16:31:37
------------------------------------------------------------------------------------------------
